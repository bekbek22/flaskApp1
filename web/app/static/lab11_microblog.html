<!doctype html>
<html lang="en">
 
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
  <!-- Bootstrap Table -->
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.css">
  <script src="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.js"></script>
  <!-- our own css -->
  <link rel="stylesheet" href="static/css/phonebook.css">
  <link rel="stylesheet" href="static/css/mytwitter.css">
  <link rel="stylesheet" href="static/css/playground.css">
  <link type="text/css" rel="stylesheet" media="screen" href="//fonts.googleapis.com/css?family=Kanit">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My microblog</title>
</head>
 
<body>
    <nav class="navbar navbar-expand-md navbar-light">
        <div class="container">
          <div class="navbar-nav">
            <a class="nav-item nav-link" href="#"><span class="oi oi-home"></span> Home</a>
            <a class="nav-item nav-link" href="#"><span class="oi oi-bolt"></span> Moments</a>
            <a class="nav-item nav-link" href="#"><span class="oi oi-bell"></span> Notifications</a>
            <a class="nav-item nav-link" href="#"><span class="oi oi-envelope-open"></span> Messages</a>
          </div>
          <form class="form-inline">
            <input class="form-control" id="nav-search" type="search" placeholder="Search Twitter"> &nbsp;
            <img class="tw-user-small rounded-circle" src="static/img/tweeterUserSmall.jpg">
          </form>
          <button class="btn" id="nav-tweet-btn" onclick="openForm()">Tweet</button>
        </div>
    </nav>
    <!--Tweet button-->
    <!--Form -->
    <div class="form-popup" id="myForm">
      <form class="form-container" id="addPhoneNumberForm">
        <h1>New Post</h1>
        <label for="name">‡∏ä‡∏∑‡πà‡∏≠</label>
        <input type="text" id="name" name="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." required>
        <label for="message">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
        <input type="text" id="message" name="message" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
        <label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
        <input type="text" id="email" name="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>
        <input type="hidden" id="entryid" name="id" value="">
        <input type="submit" class="btn" name="submit" value="Submit">
        <button type="button" class="btn clear">Clear</button>
        <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
      </form>
    </div>

    <div class="container">
        <div class="row">
          <div id="left_3" class="col-md-3">
            <div class="content-box">Account details</div>
            <div class="content-box">Trends</div>
          </div>

          <div id="center_6" class="col-md-6">
            <div class="content-box">
                <div class="new-tweet-row">
                    <div class="row">
                      <div class="col-md-2">
                        <img src="static/img/tweeterUserSmall.jpg" class="tw-user-small rounded-circle mx-auto d-block">
                      </div>
                      <div class="col-md-9">
                        <form>
                          <input id="tweet-input" class="form-control" type="text" placeholder="Whats happening?">
                        </form>
                      </div>
                  </div>
              </div>
         </div>

         <div id="contact_display" class="container">
          <h2>Contacts:</h2>
          <table class="table-striped border-success" id="phonebook-table">
            <thead>
              <tr>
                <th data-field="id">
                  <span class="text-success">
                    id
                  </span>
                </th>
                <th data-field="name">
                  <span class="text-success">
                    ‡∏ä‡∏∑‡πà‡∏≠
                  </span>
                </th>
                <th data-field="message">
                  <span class="text-success">
                    ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                  </span>
                </th>
                <th data-field="email">
                  <span class="text-success">
                    ‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                  </span>
                </th>
                <th data-field="times">
                  <span class="text-success" id="currenttime">
                    ‡πÄ‡∏ß‡∏•‡∏≤
                  </span>
                </th>
                <th data-field="operation" data-formatter="actionFormatter" data-events="operateEvents">
                  <span class="text-success">
                    ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
                  </span>
                </th>
              </tr>
            </thead>
          </table>
        </div>
    </div>

    <script>

      var date = new Date();
      var offset = date.getTimezoneOffset()

      document.getElementById("currenttime").innerHTML = offset;

      function openForm() {
        document.getElementById("myForm").style.display = "block";
      }
      
      function closeForm() {
        document.getElementById("myForm").style.display = "none";
      }

      function populate_table(contact_data) {
        $('#phonebook-table').bootstrapTable({
          data: contact_data
        });
      }
      $(document).ready(function () {
        (function () {
          $.getJSON("lab11/blog", populate_table);
        })();
      });
  
      $("#addPhoneNumberForm").submit(function (event) {
        // prevent default html form submission action
        event.preventDefault();
  
        // pack the inputs into a dictionary
        var formData = {};
        $(":input").each(function () {
          var key = $(this).attr('name');
          var val = $(this).val();
  
          if (key != 'submit') {
            formData[key] = val;
          }
  
        });
  
        var $form = $(this);
        var url = $form.attr("action");
  
        // make a POST call to the back end w/ a callback to refresh the table
        $.post(url, formData, function (contact_data) {
          refresh_table(contact_data);
          clearForm();
        });
      });
  
      function clearForm() {
        $('#addPhoneNumberForm')[0].reset();
        $('#entryid').val('');
      }
  
      function actionFormatter(value, row, index) {
        return [
          '<a class="edit" href="javascript:void(0)" title="Like">',
          '‚úèÔ∏è',
          '</a>  ',
          '<a class="remove" href="javascript:void(0)" title="Remove">',
          'üóëÔ∏è',
          '</a>'
        ].join('')
      }
  
      window.operateEvents = {
        'click .edit': function (e, value, row, index) {
          prePopulateForm(row);
        },
        'click .remove': function (e, value, row, index) {
          removeItem(row);
        }
      }
  
      function prePopulateForm(row) {
        $('#addPhoneNumberForm')[0].reset();
        $('#name').val(row.name)
        $('#message').val(row.message)
        $('#email').val(row.email)
        $('#entryid').val(row.id)
        $('#times').val(row.times)
        
      }
  
      function removeItem(row) {
        if (!confirm("Delete " + row.name + ' ' + row.message + '?')) {
          return false;
        }
        var url = "lab11/remove_post"
        var formData = { 'id': row.id };
        $.post(url, formData, function (contact_data) {
          refresh_table(contact_data);
        });
      }

      function refresh_table(contact_data) {
        $('#phonebook-table').bootstrapTable('load', contact_data);
      }
  
      function populate_table(contact_data) {
        $('#phonebook-table').bootstrapTable({
          data: contact_data
        });
        $('#phonebook-table').bootstrapTable('hideColumn', 'id');
      }
  
      function toggleView() {
        if ($('#contact_display').attr('hidden')) {
          $('#contact_display').removeAttr('hidden');
          $('#add-edit').attr('hidden', 'hidden');
        } else {
          $('#contact_display').attr('hidden', 'hidden');
          $('#add-edit').removeAttr('hidden');
        }
      }
  
      $("#add_contact").click(function () {
        clearForm();
        toggleView();
      });
  
      $("#clear_form").click(function () {
        clearForm();
      });
  
      $("#cancel_form").click(function () {
        clearForm();
        toggleView();
      });
    </script>

</body>
 
</html>
