<!doctype html>
<html lang="en">
 
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
  <!-- Bootstrap Table -->
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.css">
  <script src="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.js"></script>
  <!-- our own css -->
  <link rel="stylesheet" href="static/css/phonebook.css">
  <link rel="stylesheet" href="static/css/mytwitter.css">
  <link rel="stylesheet" href="static/css/playground.css">
  <link type="text/css" rel="stylesheet" media="screen" href="//fonts.googleapis.com/css?family=Kanit">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My microblog</title>
</head>
 
<body>
    <nav class="navbar navbar-expand-md navbar-light">
        <div class="container">
          <div class="navbar-nav">
            <a class="nav-item nav-link" href="#"><span class="oi oi-home"></span> Home</a>
            <a class="nav-item nav-link" href="#"><span class="oi oi-bolt"></span> Moments</a>
            <a class="nav-item nav-link" href="#"><span class="oi oi-bell"></span> Notifications</a>
            <a class="nav-item nav-link" href="#"><span class="oi oi-envelope-open"></span> Messages</a>
          </div>
          <form class="form-inline">
            <input class="form-control" id="nav-search" type="search" placeholder="Search Twitter"> &nbsp;
            <img class="tw-user-small rounded-circle" src="static/img/tweeterUserSmall.jpg"> &nbsp;
            <button class="btn" id="nav-tweet-btn">Tweet</button>
          </form>
        </div>
    </nav>
    <!--Tweet button-->
    <!--Form -->

    <div class="container">
        <div class="row">
          <div id="left_3" class="col-md-3">
            <div class="content-box">Account details</div>
            <div class="content-box">Trends</div>
          </div>

          <div id="center_6" class="col-md-6">
            <div class="content-box">
                <div class="new-tweet-row">
                    <div class="row">
                      <div class="col-md-2">
                        <img src="static/img/tweeterUserSmall.jpg" class="tw-user-small rounded-circle mx-auto d-block">
                      </div>
                      <div class="col-md-9">
                        <form class="form-container" id="addPhoneNumberForm">
                          <label for="name">Name</label>
                          <input type="text" id="name" name="name" placeholder="YourName..." required>
                          <label for="message">Message</label>
                          <input type="text" id="message" name="message" placeholder="YourMessage..." required>
                          <label for="email">Email</label>
                          <input type="text" id="email" name="email" placeholder="YourEmail..." required>
                          <input type="hidden" id="entryid" name="id" value="">
                          <button type="submit" class="btn" id="nav-tweet-btn" name="submit">Tweet</button>
                          <button type="button" class="btn clear">Clear</button>
                        </form>
                      </div>
                  </div>
              </div>
         </div>

         <div class="tweet" id="post">
            <div class="row">
                <div class="col-md-2 text-center">

                </div>            
                <div class="col-md-10">
                    <div class="row tweet-info">
                        <div class="col-md-auto">
                          <span class="tweet-username" id="name"></span>
                          <span class="tweet-usertag text-muted" id="email"></span>
                          <span class="tweet-age text-muted" id="datetime_created"></span>
                        </div>
                        <div class="col tweet-arrow text-muted">
                          <span class="oi oi-arrow-thick-bottom float-right"></span>
                        </div>
                      </div>
                      <div class="tweet-text" id="message">

                      </div>
                      <div class="tweet-media">

                      </div>
                      <div class="row text-muted">
                        <div class="col-md-2"><span class="oi oi-bullhorn"></span></div>
                        <div class="col-md-2"><span class="oi oi-loop-circular"></span></div>
                        <div class="col-md-2"><span class="oi oi-heart"></span></div>
                        <div class="col-md-2"><span class="oi oi-envelope-open"></span></div>
                      </div>
                  </div>
              </div>
          </div>


    </div>
    
    <script>

      function openForm() {
        document.getElementById("myForm").style.display = "block";
      }
      
      function closeForm() {
        document.getElementById("myForm").style.display = "none";
      }

      function populate_table(contact_data) {
        var blogpsot = document.getElementById("post");

        //The forEach() method calls a function for each element in an array.
        //The Object.keys() static method returns an array of a given object's own enumerable string-keyed property names.
        
        Object.keys(contact_data).reverse().forEach(function (i) {
          var data = contact_data[i];
          var para = document.createElement("div");
          para.innerHTML = `

          <div class="tweet" id="post">
            <div class="row">
                <div class="col-md-2 text-center">
                    <img class="tw-user-medium rounded-circle" src="static/img/tweeterUserSmall.jpg">
                </div>            
                <div class="col-md-10">
                    <div class="row tweet-info">
                        <div class="col-md-auto">
                          <span class="tweet-username" id="name">${data.name}</span>
                          <span class="tweet-usertag text-muted" id="email">${data.email}</span> 
                          <span class="tweet-age text-muted" id="datetime_created">${data.datetime_created}</span>
                        </div>
                        <div class="col tweet-arrow text-muted">
                          <span class="oi oi-arrow-thick-bottom float-right"></span>
                        </div>
                      </div>
                      <div class="tweet-text" id="message">
                            ${data.message}
                      </div>
                      <div class="tweet-media">
                            
                      </div>
                      <div class="row text-muted">
                        <div class="col-md-2"><span class="oi oi-bullhorn"></span></div>
                        <div class="col-md-2"><span class="oi oi-loop-circular"></span></div>
                        <div class="col-md-2"><span class="oi oi-heart"></span></div>
                        <div class="col-md-2"><span class="oi oi-envelope-open"></span></div>
                      </div>
                  </div>
              </div>
          </div>

          `;

        var element = document.getElementById("post");
        element.appendChild(para);
        });

      }


      $(document).ready(function () {
        (function () {
          $.getJSON("lab11/blog", populate_table);
        })();
      });
  
      $("#addPhoneNumberForm").submit(function (event) {
        // prevent default html form submission action
        event.preventDefault();
      
        // pack the inputs into a dictionary
        var formData = {};
        $(":input").each(function () {
          var key = $(this).attr('name');
          var val = $(this).val();
  
          if (key != 'submit') {
            formData[key] = val;
          }
  
        });
  
        var $form = $(this);
        var url = $form.attr("action");
  
        // make a POST call to the back end w/ a callback to refresh the table
        $.post(url, formData, function (contact_data) {
          refresh_table(contact_data);
          clearForm();
        });
      });
  
      function clearForm() {
        $('#addPhoneNumberForm')[0].reset();
        $('#entryid').val('');
      }
  
      function actionFormatter(value, row, index) {
        return [
          '<a class="edit" href="javascript:void(0)" title="Like">',
          '‚úèÔ∏è',
          '</a>  ',
          '<a class="remove" href="javascript:void(0)" title="Remove">',
          'üóëÔ∏è',
          '</a>'
        ].join('')
      }
  
      window.operateEvents = {
        'click .edit': function (e, value, row, index) {
          prePopulateForm(row);
        },
        'click .remove': function (e, value, row, index) {
          removeItem(row);
        }
      }
  
      function prePopulateForm(row) {
        $('#addPhoneNumberForm')[0].reset();
        $('#name').val(row.name)
        $('#message').val(row.message)
        $('#email').val(row.email)
        $('#entryid').val(row.id)
        $('#datetime_created').val(row.datetime_created)
        $('#datetime_updated').val(row.datetime_updated)
      }
  
      function removeItem(row) {
        if (!confirm("Delete " + row.name + ' ' + row.message + '?')) {
          return false;
        }
        var url = "lab11/remove_post"
        var formData = { 'id': row.id };
        $.post(url, formData, function (contact_data) {
          refresh_table(contact_data);
        });
      }

      function refresh_table(contact_data) {
        $('#phonebook-table').bootstrapTable('load', contact_data);
      }
  
  
      function toggleView() {
        if ($('#contact_display').attr('hidden')) {
          $('#contact_display').removeAttr('hidden');
          $('#add-edit').attr('hidden', 'hidden');
        } else {
          $('#contact_display').attr('hidden', 'hidden');
          $('#add-edit').removeAttr('hidden');
        }
      }
  
      $("#add_contact").click(function () {
        clearForm();
        toggleView();
      });
  
      $("#clear_form").click(function () {
        clearForm();
      });
  
      $("#cancel_form").click(function () {
        clearForm();
        toggleView();
      });
    </script>

</body>
 
</html>
